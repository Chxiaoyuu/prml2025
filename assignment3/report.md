# 基于LSTM的污染浓度预测实验报告

## 1. 问题描述
针对空气质量监测场景，建立多变量时间序列预测模型，使用历史气象数据（温度、湿度、风速等）和污染物浓度数据，预测未来1小时的PM2.5浓度值。主要挑战包括：
- 时间序列的长期依赖建模
- 多变量特征间的复杂关系捕捉
- 传感器数据中的噪声和缺失值处理

## 2. 概要
本实验构建了双层LSTM神经网络模型，使用过去24小时的8维特征数据（包含气象指标和历史浓度值），预测未来1小时的PM2.5浓度。

## 3. LSTM结构原理

### LSTM 数学公式

#### 核心组件公式

##### 1. 遗忘门 (Forget Gate)

$$
f_t = \sigma(W_f \cdot [h_{t-1}, x_t] + b_f)
$$

##### 2. 输入门 (Input Gate)

$$
i_t = \sigma(W_i \cdot [h_{t-1}, x_t] + b_i)
$$

##### 3. 候选细胞状态 (Candidate Cell State)

$\tilde{C}_t = \tanh(W_C \cdot [h_{t-1}, x_t] + b_C)$

##### 4. 细胞状态更新 (Cell State Update)

$$
C_t = f_t \odot C_{t-1} + i_t \odot \tilde{C}_t
$$

##### 5. 输出门 (Output Gate)

$$
o_t = \sigma(W_o \cdot [h_{t-1}, x_t] + b_o)
$$

##### 6. 隐藏状态输出 (Hidden State Update)

$$
h_t = o_t \odot \tanh(C_t)
$$


#### 符号说明

| 符号         | 描述                          | 维度                     |
|--------------|-------------------------------|--------------------------|
| $x_t$        | 当前时间步输入向量            | $(d_{in},)$              |
| $h_{t-1}$    | 前一时间步隐藏状态            | $(d_{hidden},)$          |
| $C_{t-1}$    | 前一时间步细胞状态            | $(d_{hidden},)$          |
| $W_*$        | 权重矩阵 (f,i,C,o 对应不同门) | $(d_{hidden}, d_{in}+d_{hidden})$ |
| $b_*$        | 偏置项                        | $(d_{hidden},)$          |
| $\sigma$     | Sigmoid 激活函数              | $\sigma(x) = \frac{1}{1+e^{-x}}$ |
| $\odot$      | Hadamard 积 (逐元素相乘)      |                          |



#### 公式流程说明

```mermaid
graph TD
    A["输入 h_{t-1}, x_t"] --> B["计算遗忘门 f_t"]
    A --> C["计算输入门 i_t"]
    A --> D["计算候选状态 ~C_t"]
    B --> E["细胞状态更新 C_t"]
    C --> E
    D --> E
    A --> F["计算输出门 o_t"]
    E --> G["计算新隐藏状态 h_t"]
    F --> G
```

## 4. 实验配置
### 4.1 模型参数
| 参数层         | 配置说明                  | 参数值       |
|----------------|-------------------------|-------------|
| 输入层         | 时间步长 × 特征维度       | 24×13       |
| LSTM1          | 隐藏单元数 + Return Seq | 64 + True   |
| Dropout1       | 随机失活率               | 0.2         |
| LSTM2          | 隐藏单元数               | 32          |
| Dropout2       | 随机失活率               | 0.2         |
| 输出层         | 全连接层                 | 1 neuron    |

### 4.2 训练参数
```python
{
    "optimizer": "Adam",
    "learning_rate": 0.001,
    "batch_size": 72,
    "epochs": 100,
    "early_stop": {
        "monitor": "val_loss",
        "patience": 5
    },
    "loss": "MSE"
}
```
## 5. 实验步骤
### 5.1 数据预处理流程
```mermaid
graph TD
    A[原始数据] --> B{缺失值处理}
    B -->|线性插值| C[异常值修正]
    C --> D[特征工程]
    D --> E[归一化处理]
    E --> F[构建监督数据集]
    F --> G[训练/测试分割]
```
**具体处理步骤：**

- ​时间对齐​：将原始10分钟粒度数据重采样为小时粒度
-​ 风向编码​：将文本风向（NW/SE等）转换为数值编码

**​特征构造​：**

- 添加时间特征：hour, day_cos
- 成滞后特征：pollution_lag{1,2,3}
- 归一化​：使用MinMaxScaler将数据缩放到[0,1]区间

### 5.2 模型训练过程

**核心训练代码**
```python
{
    history = model.fit(
    X_train, y_train,
    validation_split=0.2,
    callbacks=[EarlyStopping(monitor='val_loss', patience=5)],
    verbose=1
}
```

### 5.3 评估指标计算

​**指标计算公式​：**



- 平均绝对误差（MAE）

$$
\text{MAE} = \frac{1}{n} \sum_{i=1}^{n} |y_{\text{true}}^{(i)} - y_{\text{pred}}^{(i)}|
$$

- 均方根误差（RMSE）

$$
\text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} \left(y_{\text{true}}^{(i)} - y_{\text{pred}}^{(i)}\right)^2}
$$

- 决定系数（R²）

$$
R^2 = 1 - \frac{\sum_{i=1}^{n} \left(y_{\text{true}}^{(i)} - y_{\text{pred}}^{(i)}\right)^2}{\sum_{i=1}^{n} \left(y_{\text{true}}^{(i)} - \bar{y}_{\text{true}}\right)^2}
$$


​**指标特点**​：
- ​MAE: 对异常值不敏感，反映平均绝对误差
- ​RMSE: 放大较大误差的影响，单位与原始数据一致
- ​R²: 取值区间为 $(-\infty, 1]$ ，越接近1说明模型解释力越强

## 6. 实验结果
### 6.1 训练过程曲线

**关键观察点：**

- 第23 epoch触发早停机制
- 验证损失稳定在0.015-0.017区间
- 无明显过拟合现象

### 6.2 预测结果可视化

### 6.3 性能指标

| 数据集 | MAE(μg/m³) | RMSE(μg/m³) | R²    |
|--------|------------|-------------|-------|
| 训练集 | 9.82       | 14.56       | 0.92  |
| 测试集 | 12.45      | 18.32       | 0.89  |

## 7. 实验分析
### 7.1 结果讨论

​**模型有效性​** 

R²达到0.89，表明模型能解释89%的浓度变化

​**误差来源​**

- 极端天气事件（如沙尘暴）未包含在特征中
- 节假日交通模式变化未显式建模
  
​**改进方向​**

- 添加空气质量指数(AQI)分级特征
- 尝试注意力机制+BiLSTM架构
